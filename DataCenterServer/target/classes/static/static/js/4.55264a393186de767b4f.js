webpackJsonp([4],{"8Gjx":function(e,t,a){"use strict";a("4Zt/");var i=a("z/Aw"),s=a("zL8q"),l={name:"select_objAttr",props:{objs:Array},data:function(){return{objList:[],attrList:[],objAttr:{},checkedObiIndex:"",checkedAttr:[]}},created:function(){var e=this;this.objList=[],this.attrList=[],this.objs?this.objList=this.objs:i.a.getDataObjectsList({type:"对象",isDic:"",name:"",pageInfo:{page:0,pageSize:0}}).then(function(t){e.objList=t.data.list}).catch(function(e){console.log(e),s.Message.error("获取对象列表失败。",e)})},mounted:function(){},methods:{selectedName:function(e){for(var t=0;t<this.objList.length;t++){var a=this.objList[t];if(a.id==e)return a.name}},changeCheckedAttr:function(){var e=[];return console.log("this.checkedAttr",this.checkedAttr),this.checkedAttr.forEach(function(t,a){var i={};i.resId=t.split(",")[3],i.id=t.split(",")[2],e[a]=i}),e}},watch:{checkedObiIndex:function(e){var t=this;this.objAttr[e]||(this.attrList=[],i.a.getDataObjectAttrsList({resId:e,pageInfo:{page:0,pageSize:0}}).then(function(e){t.attrList=e.data.list}).catch(function(e){console.log(e),s.Message.error("获取属性列表失败。",e)}))},checkedAttr:function(e){var t=this.changeCheckedAttr();console.log("changeCheckedAttr()",t),this.$emit("listenDatasetAttrs",t)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",border:"1px solid #eee"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("p",[e._v("浏览对象：")]),e._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择浏览对象"},model:{value:e.checkedObiIndex,callback:function(t){e.checkedObiIndex=t},expression:"checkedObiIndex"}},e._l(this.objList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),e._v(" "),a("div",{staticStyle:{border:"1px solid #eee","margin-top":"10px",height:"150px","overflow-y":"auto"}},e._l(e.attrList,function(t,i){return a("p",{key:i},[a("el-checkbox",{attrs:{label:e.selectedName(t.resId)+","+t.name+","+t.id+","+t.resId},model:{value:e.checkedAttr,callback:function(t){e.checkedAttr=t},expression:"checkedAttr"}},[e._v(e._s(t.name))])],1)}))],1),e._v(" "),a("el-col",{staticStyle:{height:"200px","overflow-y":"auto"},attrs:{span:12}},[a("p",[e._v("选择对象：")]),e._v(" "),a("p",[a("label",{staticStyle:{display:"inline-block",width:"45%"}},[e._v("对象名称")]),e._v(" "),a("label",{staticStyle:{display:"inline-block",width:"45%"}},[e._v("属性名称")])]),e._v(" "),e._l(e.checkedAttr,function(t,i){return a("p",{key:i,staticStyle:{"margin-left":"10px"}},[a("label",{staticStyle:{display:"inline-block",width:"45%"}},[e._v(e._s(t.split(",")[0]))]),e._v(" "),a("el-checkbox",{staticStyle:{width:"45%"},attrs:{label:t},model:{value:e.checkedAttr,callback:function(t){e.checkedAttr=t},expression:"checkedAttr"}},[e._v(e._s(t.split(",")[1]))])],1)})],2)],1)],1)},staticRenderFns:[]},r=a("VU/8")(l,o,!1,null,null,null);t.a=r.exports},OsvX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("fZjL"),s=a.n(i),l=a("woOf"),o=a.n(l),r=(a("4Zt/"),a("z/Aw")),n=a("zL8q"),d={name:"Resource",components:{selectObjAttr:a("8Gjx").a},data:function(){return{dataObject:{id:"",name:""},viewTable:{domId:"",className:"",pageInfo:{page:1,count:0,pageSize:100},data:[]},viewSearch:{data:{type:"",isDic:"",name:""},show:!1},viewAdd:{data:{},show:!1},viewEdit:{index:"",data:"",show:!1},viewDelet:{show:!1,item:{},index:""},addrules:{name:[{required:!0,message:"请输入字段名",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],defined:[{required:!0,message:"输入数据定义",trigger:"blur"}],isDic:[{required:!0,message:"请选择是否是字典",trigger:"change"}]},reviserules:{name:[{required:!0,message:"请输入字段名",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],defined:[{required:!0,message:"输入数据定义",trigger:"blur"}],isDic:[{required:!0,message:"请选择是否是字典",trigger:"change"}],description:[{required:!0,message:"添加对表的描述",trigger:"blur"}]},_DatasetAttrs:[]}},created:function(){var e=this;r.a.getDataObjectsList({type:this.viewSearch.data.type,isDic:this.viewSearch.data.isDic,name:this.viewSearch.data.name,pageInfo:this.viewTable.pageInfo}).then(function(t){console.log("我是成功返回的res",t),e.viewTable.data=t.data.list,e.viewTable.pageInfo.total=t.data.pageInfo.total}).catch(function(e){console.log(e),n.Message.error(e.data.message)})},methods:{handleEdit:function(e,t){console.log("edit",e,t),this.viewEdit.data=o()({},e),this.viewEdit.old=o()({},e),this.viewEdit.index=t,this.viewEdit.show=!0},diff:function(e){function t(t,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){console.log("我是diff",1111);var a=e instanceof Object,i=t instanceof Object;if(console.log(22,a,i),!a||!i)return e===t;if(s()(e).length!==s()(t).length)return!1;for(var l in e){var o=e[l]instanceof Object,r=t[l]instanceof Object;if(o&&r)return diff(e[l],t[l]);if(e[l]!==t[l])return!1}return!0}),editSingle:function(){var e=this;1==this.diff(this.viewEdit.data,this.viewEdit.old)?n.Message.warning("修改前和修改后的数据一致"):this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;r.a.editDataObject(e.viewEdit.data).then(function(t){console.log("修改",t),(t.success=!0)&&(n.Message.success("修改成功"),e.handleSearch(),e.viewEdit.show=!1)}).catch(function(e){console.log(e),n.Message.error(e.data.message)})})},editCancel:function(){this.viewEdit.show=!1,this.$refs.form.resetFields()},handleDelet:function(e,t){console.log("delet",e),this.viewDelet.item=e,this.viewDelet.index=t,this.viewDelet.show=!0},deletSingle:function(){var e=this;r.a.deleteDataObject({id:this.viewDelet.item.id}).then(function(t){1==t.success&&(n.Message.success("删除成功"),e.handleSearch(),e.viewDelet.show=!1)}).catch(function(e){console.log(e),n.Message.error(e.data.message)})},handleAdd:function(e){this.viewAdd.show=!0},closeDialog:function(){this.$refs.form.resetFields()},addSingle:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;console.log(e._DatasetAttrs);var a=o()({},e.viewAdd.data);console.log(a.type),"对象"==a.type||"数据集"==a.type&&e._DatasetAttrs&&e._DatasetAttrs.length>0?r.a.addDataObject(a).then(function(t){if(console.log(88,t),1==t.success){for(var i in n.Message.success("添加成功"),"对象"==a.type?e.handleSearch():(console.log("addDataAttrs 开始"),e.addDatasetAttrs(t.data.id)),e.handleSearch(),e.viewAdd.data)e.viewAdd.data[i]="";e.viewAdd.show=!1}else n.Message.error("添加失败。")}).catch(function(e){console.log(e),n.Message.error(e.data.message)}):n.Message.warning("创建数据集，数据集属性不能为空。")})},addCancel:function(){this.viewAdd.show=!1,this.$refs.form.resetFields()},handleSearch:function(){var e=this;console.log(this.viewSearch.data.type,this.viewSearch.data.isDic,this.viewSearch.data.name),r.a.getDataObjectsList({type:this.viewSearch.data.type,isDic:this.viewSearch.data.isDic,name:this.viewSearch.data.name,pageInfo:this.viewTable.pageInfo}).then(function(t){e.viewTable.data=t.data.list}).catch(function(e){console.log(e),n.Message.error(e.data.message)})},handleAttr:function(e,t){console.log(e,t),"对象"==e.type?this.$router.push({path:"/resource/object/"+e.id}):"数据集"==e.type&&this.$router.push({path:"/resource/dataset/"+e.id})},handleData:function(e,t){this.$router.push({path:"/resource/"+e.id+"/data"})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.viewTable.pageInfo.page=1,this.viewTable.pageInfo.pageSize=e,this.handleSearch()},handleCurrentChange:function(e){console.log("当前页: "+e),this.viewTable.pageInfo.page=e,this.handleSearch()},addDatasetAttrs:function(e){var t=this,a=this._DatasetAttrs;a.length<=0||(console.log("adddDatasetAttrs 接口",a),r.a.addDataObjectAttr({objectId:e,list:a}).then(function(e){console.log("添加属性",e),1==e.success?(n.Message.success("添加数据集属性成功。"),t.viewAdd.show=!1):n.Message.error("添加数据集属性失败。")}).catch(function(e){console.log(e),n.Message.error("添加数据集属性失败。"+e)}))},_getDatasetAttrs:function(e){console.log("_getDatasetAttrs",e),this._DatasetAttrs=e}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resource"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("div",{staticClass:"breadxian"}),e._v(" "),a("el-breadcrumb-item",{attrs:{to:{path:"/resource"}}},[e._v("资源目录")])],1),e._v(" "),a("div",{staticClass:"breadbottom"}),e._v(" "),a("el-form",{attrs:{inline:"",model:e.viewSearch.data,"label-position":"right","label-width":"80px"}},[a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.viewSearch.data.type,callback:function(t){e.$set(e.viewSearch.data,"type",t)},expression:"viewSearch.data.type"}},[a("el-option",{attrs:{label:"--",value:""}}),e._v(" "),a("el-option",{attrs:{label:"对象",value:"对象"}}),e._v(" "),a("el-option",{attrs:{label:"数据集",value:"数据集"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否字典"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.viewSearch.data.isDic,callback:function(t){e.$set(e.viewSearch.data,"isDic",t)},expression:"viewSearch.data.isDic"}},[a("el-option",{attrs:{label:"--",value:""}}),e._v(" "),a("el-option",{attrs:{label:"是",value:"true"}}),e._v(" "),a("el-option",{attrs:{label:"否",value:"false"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"搜索对象"}},[a("el-input",{attrs:{placeholder:"输入名称/说明关键词"},model:{value:e.viewSearch.data.name,callback:function(t){e.$set(e.viewSearch.data,"name",t)},expression:"viewSearch.data.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleSearch()}}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.handleAdd()}}},[e._v("创建")])],1)],1),e._v(" "),a("div",{staticClass:"viewTableClass"},[a("el-table",{attrs:{data:e.viewTable.data,border:"","header-cell-style":{background:"#f9fafc"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"类型",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"defined",label:"数据定义",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"isDic",label:"是否字典",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"说明"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){e.handleData(t.row,t.$index)}}},[e._v("数据")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){e.handleAttr(t.row,t.$index)}}},[e._v("属性")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){e.handleEdit(t.row,t.$index)}}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDelet(t.row,t.$index)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-pagination",{staticClass:"pageArea",attrs:{"current-page":e.viewTable.pageInfo.page,"page-sizes":[100,200,300,400],"page-size":e.viewTable.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.viewTable.pageInfo.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:"创建数据对象",visible:e.viewAdd.show,"close-on-click-modal":!1,width:"30%",id:"viewAdd"},on:{"update:visible":function(t){e.$set(e.viewAdd,"show",t)},close:e.closeDialog}},[a("el-form",{ref:"form",attrs:{model:e.viewAdd.data,rules:e.addrules,"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入字段名"},model:{value:e.viewAdd.data.name,callback:function(t){e.$set(e.viewAdd.data,"name",t)},expression:"viewAdd.data.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"类型：",prop:"type"}},[[a("el-radio-group",{model:{value:e.viewAdd.data.type,callback:function(t){e.$set(e.viewAdd.data,"type",t)},expression:"viewAdd.data.type"}},[a("el-radio",{attrs:{label:"对象"}},[e._v("对象")]),e._v(" "),a("el-radio",{attrs:{label:"数据集"}},[e._v("数据集")])],1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"数据定义：",prop:"defined"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入字段名"},model:{value:e.viewAdd.data.defined,callback:function(t){e.$set(e.viewAdd.data,"defined",t)},expression:"viewAdd.data.defined"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否字典：",prop:"isDic"}},[[a("el-radio-group",{model:{value:e.viewAdd.data.isDic,callback:function(t){e.$set(e.viewAdd.data,"isDic",t)},expression:"viewAdd.data.isDic"}},[a("el-radio",{attrs:{label:"true"}},[e._v("是\n            ")]),e._v(" "),a("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"说明："}},[a("el-input",{attrs:{placeholder:"请输入字段名"},model:{value:e.viewAdd.data.description,callback:function(t){e.$set(e.viewAdd.data,"description",t)},expression:"viewAdd.data.description"}})],1),e._v(" "),"数据集"==e.viewAdd.data.type?a("selectObjAttr",{on:{listenDatasetAttrs:e._getDatasetAttrs}}):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.addCancel("formb")}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addSingle()}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改数据集属性",visible:e.viewEdit.show,"close-on-click-modal":!1,width:"30%",id:"viewEdit"},on:{"update:visible":function(t){e.$set(e.viewEdit,"show",t)},close:e.closeDialog}},[a("el-form",{ref:"form",attrs:{model:e.viewEdit.data,rules:e.reviserules,"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入字段名"},model:{value:e.viewEdit.data.name,callback:function(t){e.$set(e.viewEdit.data,"name",t)},expression:"viewEdit.data.name"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"类型： ",prop:"type"}},[[a("el-radio-group",{model:{value:e.viewEdit.data.type,callback:function(t){e.$set(e.viewEdit.data,"type",t)},expression:"viewEdit.data.type"}},[a("el-radio",{attrs:{label:"对象"}},[e._v("对象")]),e._v(" "),a("el-radio",{attrs:{label:"数据集"}},[e._v("数据集")])],1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"数据定义：",prop:"defined"}},[a("el-input",{attrs:{placeholder:"请输入字段名"},model:{value:e.viewEdit.data.defined,callback:function(t){e.$set(e.viewEdit.data,"defined",t)},expression:"viewEdit.data.defined"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否字典：",prop:"isDic"}},[[a("el-radio-group",{model:{value:e.viewEdit.data.isDic,callback:function(t){e.$set(e.viewEdit.data,"isDic",t)},expression:"viewEdit.data.isDic"}},[a("el-radio",{attrs:{label:"true"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"说明：",prop:"description"}},[a("el-input",{attrs:{placeholder:"请输入字段名"},model:{value:e.viewEdit.data.description,callback:function(t){e.$set(e.viewEdit.data,"description",t)},expression:"viewEdit.data.description"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.editCancel()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editSingle()}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"删除",visible:e.viewDelet.show,width:"30%",id:"viewDelet"},on:{"update:visible":function(t){e.$set(e.viewDelet,"show",t)}}},[a("div",{staticClass:"modal-body"},[e._v("\n      您确定删除要删除该项吗?\n    ")]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.viewDelet.show=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.deletSingle()}}},[e._v("确定")])],1)])],1)},staticRenderFns:[]},v=a("VU/8")(d,c,!1,null,null,null);t.default=v.exports}});
//# sourceMappingURL=4.55264a393186de767b4f.js.map